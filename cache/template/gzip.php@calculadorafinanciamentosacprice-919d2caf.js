google.load("visualization","1",{packages:["corechart"]});jQuery(document).ready(function(){jQuery("#id2").maskMoney({symbol:'R$ ',showSymbol:true,thousands:'.',decimal:',',symbolStay:true});jQuery("#id3").maskMoney({symbol:'R$ ',showSymbol:true,thousands:'.',decimal:',',symbolStay:true});jQuery("#id4").maskMoney({thousands:'.',decimal:','});jQuery("#id6").maskMoney({thousands:'.',decimal:','});jQuery("#id8").maskMoney({symbol:'R$ ',showSymbol:true,thousands:'.',decimal:',',symbolStay:true});jQuery("#id6").maskMoney({thousands:'.',decimal:',',precision:0});jQuery('input.datepick').datepicker();jQuery("#id2").focus();jQuery('#jp-left').css('height',jQuery(document).height());});function calcula(){switch(jQuery('#id1').val()){case'juros':e=jQuery('#id2').val();e=(e=="")?"0":e;vp=jQuery('#id8').val();vf=jQuery('#id3').val();t=jQuery('#id6').val();if(jQuery('#chk3').is(':checked')){if(e==""||vf==""||t==""||vp==""){alert('Por favor preecha todos os campos!');return;}}else{c1=jQuery('#dt1').val();c2=jQuery('#dt2').val();if(e==""||vf==""||vp==""||c1==""||c2==""){alert('Por favor preecha todos os campos!');return;}
t1=parseInt(c1[2]+c1[1]+c1[0]);t2=parseInt(c2[2]+c2[1]+c2[0]);if(t1>t2){alert('Data final deve ser maior que data inicial.')
return;}}
e=e.replace(/ /g,'');vp=vp.replace(/ /g,'');vf=vf.replace(/ /g,'');t=t.replace(/ /g,'');e=e.replace(/\R\$/g,'');vp=vp.replace(/\R\$/g,'');vf=vf.replace(/\R\$/g,'');t=t.replace(/\R\$/g,'');e=e.replace(/\./g,'');vp=vp.replace(/\./g,'');vf=vf.replace(/\./g,'');t=t.replace(/\./g,'');e=e.replace(/,/g,'.');vp=vp.replace(/,/g,'.');vf=vf.replace(/,/g,'.');t=t.replace(/,/g,'.');p=0;if(jQuery('#chk2').is(':checked')){if(jQuery('#chk3').is(':checked'))tc=convertetempo(t,jQuery('#id7').val());else tc=calculaMes();b_=true;i_=0;p_=0;r_=0;y_=0;x_=0;mess='';while(b_){i_=parseFloat(i_)+0.0001;i_=parseFloat(i_).toFixed(4);p_=((parseFloat(vf)-parseFloat(e))*(parseFloat(i_)/100))/(1-(1/Math.pow(1+(parseFloat(i_)/100),parseInt(tc))));if(i_==0.0001&&parseFloat(p_)>parseFloat(vp)){b_=false;mess='ne';}
if(parseFloat(p_)<parseFloat(vp)){y_=i_;}else if(parseFloat(p_)>parseFloat(vp)){x_=i_;}else{r_=i_;b_=false;}
if(x_!=0&&y_!=0){r_=x_;b_=false;}
if(parseFloat(i_)>10000){r_=0;b_=false;}}
if(mess=='ne'){jQuery('#resultado').html('Não há juros para o financiamento informado!');jQuery('#grafico').html('');return;}
jc=parseFloat(r_).toFixed(2);p=(parseFloat(vp)).toFixed(2);sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);montaPrice(sd,e,jc,tc,p,vf);}else{if(jQuery('#chk3').is(':checked'))tc=convertetempo(t,jQuery('#id7').val());else tc=calculaMes();b_=true;i_=0;p_=0;r_=0;y_=0;x_=0;mess='';while(b_){i_=parseFloat(i_)+0.0001;i_=parseFloat(i_).toFixed(4);p_=(parseFloat((parseFloat(vf)-parseFloat(e)))/parseInt(tc))+(parseFloat(i_)/100)*(parseFloat((parseFloat(vf)-parseFloat(e))));if(i_==0.0001&&parseFloat(p_)>parseFloat(vp)){b_=false;mess='ne';}
if(parseFloat(p_)<parseFloat(vp)){y_=i_;}else if(parseFloat(p_)>parseFloat(vp)){x_=i_;}else{r_=i_;b_=false;}
if(x_!=0&&y_!=0){r_=x_;b_=false;}
if(parseFloat(i_)>10000){r_=0;b_=false;}}
if(mess=='ne'){jQuery('#resultado').html('Não há juros para o financiamento informado!');jQuery('#grafico').html('');return;}
jc=parseFloat(r_).toFixed(2);p=(parseFloat(vp)).toFixed(2);sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);montaSac(e,vf,jc,tc,p,sd)}
break;case'tempo':e=jQuery('#id2').val();e=(e=="")?"0":e;vp=jQuery('#id8').val();vf=jQuery('#id3').val();j=jQuery('#id4').val();if(jQuery('#chk3').is(':checked')){if(e==""||vp==""||vf==""||j==""){alert('Por favor preecha todos os campos!');return;}}
e=e.replace(/ /g,'');vp=vp.replace(/ /g,'');vf=vf.replace(/ /g,'');j=j.replace(/ /g,'');e=e.replace(/\R\$/g,'');vp=vp.replace(/\R\$/g,'');vf=vf.replace(/\R\$/g,'');j=j.replace(/\R\$/g,'');e=e.replace(/\./g,'');vp=vp.replace(/\./g,'');vf=vf.replace(/\./g,'');j=j.replace(/\./g,'');e=e.replace(/,/g,'.');vp=vp.replace(/,/g,'.');vf=vf.replace(/,/g,'.');j=j.replace(/,/g,'.');p=0;if(jQuery('#chk2').is(':checked')){jc=convertejuros(j,jQuery('#id5').val());tc=(Math.log(parseFloat(vp)/(parseFloat(vp)-(parseFloat(jc)/100)*(parseFloat(vf)-parseFloat(e))))/Math.log(1+(parseFloat(jc)/100))).toFixed(2);p=(parseFloat(vp)).toFixed(2);sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);montaPrice(sd,e,jc,tc,p,vf);}else{jc=convertejuros(j,jQuery('#id5').val());tc=(-1*(parseFloat(vf)-parseFloat(e))/((parseFloat(jc)/100)*(parseFloat(vf)-parseFloat(e))-parseFloat(vp))).toFixed(2);sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);p=(parseFloat(vp)).toFixed(2);montaSac(e,vf,jc,tc,p,sd)}
break;case'parcela':e=jQuery('#id2').val();e=(e=="")?"0":e;vf=jQuery('#id3').val();j=jQuery('#id4').val();t=jQuery('#id6').val();if(jQuery('#chk3').is(':checked')){if(e==""||vf==""||t==""||j==""){alert('Por favor preecha todos os campos!');return;}}else{c1=jQuery('#dt1').val();c2=jQuery('#dt2').val();if(e==""||vf==""||j==""||c1==""||c2==""){alert('Por favor preecha todos os campos!');return;}
t1=parseInt(c1[2]+c1[1]+c1[0]);t2=parseInt(c2[2]+c2[1]+c2[0]);if(t1>t2){alert('Data final deve ser maior que data inicial.')
return;}}
e=e.replace(/ /g,'');vf=vf.replace(/ /g,'');t=t.replace(/ /g,'');j=j.replace(/ /g,'');e=e.replace(/\R\$/g,'');vf=vf.replace(/\R\$/g,'');t=t.replace(/\R\$/g,'');j=j.replace(/\R\$/g,'');e=e.replace(/\./g,'');vf=vf.replace(/\./g,'');t=t.replace(/\./g,'');j=j.replace(/\./g,'');e=e.replace(/,/g,'.');vf=vf.replace(/,/g,'.');t=t.replace(/,/g,'.');j=j.replace(/,/g,'.');if(parseFloat(e)>parseFloat(vf)){alert('O valor do financiamento é menor que o valor da entrada!');return;}
p=0;if(jQuery('#chk2').is(':checked')){if(jQuery('#chk3').is(':checked'))tc=convertetempo(t,jQuery('#id7').val());else tc=calculaMes();jc=convertejuros(j,jQuery('#id5').val());p=(((parseFloat(vf)-parseFloat(e))*(parseFloat(jc)/100))/(1-(1/Math.pow(1+(parseFloat(jc)/100),parseInt(tc))))).toFixed(2);sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);montaPrice(sd,e,jc,tc,p,vf);}else{if(jQuery('#chk3').is(':checked'))tc=convertetempo(t,jQuery('#id7').val());else tc=calculaMes();jc=convertejuros(j,jQuery('#id5').val());sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);p=((parseFloat((parseFloat(vf)-parseFloat(e)))/parseInt(tc))+(parseFloat(jc)/100)*(parseFloat((parseFloat(vf)-parseFloat(e))))).toFixed(2);montaSac(e,vf,jc,tc,p,sd)}
break;case'valor':e=jQuery('#id2').val();e=(e=="")?"0":e;vp=jQuery('#id8').val();j=jQuery('#id4').val();t=jQuery('#id6').val();if(jQuery('#chk3').is(':checked')){if(e==""||vp==""||t==""||j==""){alert('Por favor preecha todos os campos!');return;}}else{c1=jQuery('#dt1').val();c2=jQuery('#dt2').val();if(e==""||vp==""||j==""||c1==""||c2==""){alert('Por favor preecha todos os campos!');return;}
t1=parseInt(c1[2]+c1[1]+c1[0]);t2=parseInt(c2[2]+c2[1]+c2[0]);if(t1>t2){alert('Data final deve ser maior que data inicial.')
return;}}
e=e.replace(/ /g,'');vp=vp.replace(/ /g,'');t=t.replace(/ /g,'');j=j.replace(/ /g,'');e=e.replace(/\R\$/g,'');vp=vp.replace(/\R\$/g,'');t=t.replace(/\R\$/g,'');j=j.replace(/\R\$/g,'');e=e.replace(/\./g,'');vp=vp.replace(/\./g,'');t=t.replace(/\./g,'');j=j.replace(/\./g,'');e=e.replace(/,/g,'.');vp=vp.replace(/,/g,'.');t=t.replace(/,/g,'.');j=j.replace(/,/g,'.');p=0;if(jQuery('#chk2').is(':checked')){if(jQuery('#chk3').is(':checked'))tc=convertetempo(t,jQuery('#id7').val());else tc=calculaMes();jc=convertejuros(j,jQuery('#id5').val());vf=(((parseFloat(vp)*(1-(1/Math.pow(1+(parseFloat(jc)/100),parseInt(tc)))))/(parseFloat(jc)/100))+parseFloat(e)).toFixed(2);p=(parseFloat(vp)).toFixed(2);sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);montaPrice(sd,e,jc,tc,p,vf);}else{if(jQuery('#chk3').is(':checked'))tc=convertetempo(t,jQuery('#id7').val());else tc=calculaMes();jc=convertejuros(j,jQuery('#id5').val());vf=(((parseInt(tc)*parseFloat(vp))/(1+parseInt(tc)*(parseFloat(jc)/100)))+parseFloat(e)).toFixed(2);sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);p=(parseFloat(vp)).toFixed(2);montaSac(e,vf,jc,tc,p,sd)}
break;}
jQuery('#jp-left').css('height',jQuery(document).height());}
function limpar(){jQuery('#id1').val('parcela');jQuery('#id2').val('');jQuery('#id3').val('');jQuery('#id4').val('');jQuery('#id5').val('mes');jQuery('#id6').val('');jQuery('#id8').val('');jQuery('#id7').val('mes');jQuery('#chk2').prop('checked',true);jQuery('#chk3').click();jQuery('#resultado').html('');jQuery('#grafico').html('');}
function verif(obj){a=obj.value;a=a.replace(',','.');test=false;for(i=0;i<a.length;i++)if(a.charAt(i)!='1'&&a.charAt(i)!='2'&&a.charAt(i)!='3'&&a.charAt(i)!='4'&&a.charAt(i)!='5'&&a.charAt(i)!='6'&&a.charAt(i)!='7'&&a.charAt(i)!='8'&&a.charAt(i)!='9'&&a.charAt(i)!='0'&&a.charAt(i)!=','&&a.charAt(i)!='.')test=true;if(test==true){alert('Valor informado é inválido! Por favor insira um valor válido!');obj.value="";}}
function selecto(num){switch(num){case 11:jQuery('#chk1').prop('checked',true);break;case 12:jQuery('#chk1_2').prop('checked',true);break;case 13:jQuery('#chk1_3').prop('checked',true);break;case 21:jQuery('#chk2').prop('checked',true);break;case 22:jQuery('#chk2_1').prop('checked',true);break;case 31:jQuery('#chk3').prop('checked',true);jQuery('#idtempo2').hide('fast');jQuery('#idtempo1').show('fast');break;case 32:jQuery('#chk3_1').prop('checked',true);jQuery('#idtempo2').show('fast');jQuery('#idtempo1').hide('fast');break;}}
function acalcular(obj){switch(jQuery('#id1').val()){case'juros':jQuery('#bloco1').show('fast');jQuery('#bloco2').hide('fast');jQuery('#bloco3').show('fast');jQuery('#bloco4').show('fast');break;case'tempo':jQuery('#bloco1').show('fast');jQuery('#bloco2').show('fast');jQuery('#bloco3').hide('fast');jQuery('#bloco4').show('fast');break;case'parcela':jQuery('#bloco1').show('fast');jQuery('#bloco2').show('fast');jQuery('#bloco3').show('fast');jQuery('#bloco4').hide('fast');break;case'valor':jQuery('#bloco1').hide('fast');jQuery('#bloco2').show('fast');jQuery('#bloco3').show('fast');jQuery('#bloco4').show('fast');break;}}
function convertetempo(t,tr){ret=0;switch(tr){case'mes':ret=parseInt(t);break;case'semestre':ret=parseInt(t)*6;break;case'ano':ret=parseInt(t)*12;break;}
return ret;}
function convertejuros(j,jr){ret=0;switch(jr){case'mes':ret=parseFloat(j);break;case'semestre':ret=(Math.pow(1+(parseFloat(j)/100),1/6)-1)*100;break;case'ano':ret=(Math.pow(1+(parseFloat(j)/100),1/12)-1)*100;break;case'dia':ret=(Math.pow(1+(parseFloat(j)/100),30)-1)*100;break;case'semana':ret=(Math.pow(1+(parseFloat(j)/100),4)-1)*100;break;case'quinzena':ret=(Math.pow(1+(parseFloat(j)/100),2)-1)*100;break;}
return ret;}
function calculaMes(){c1=jQuery('#dt1').val();c2=jQuery('#dt2').val();c1=c1.split('/');c2=c2.split('/');d1=Date.parse(jQuery('#dt1').val());d2=Date.parse(jQuery('#dt2').val());dif=new TimePeriod(d1,d2);anos=12*parseInt(dif.years);meses=parseInt(dif.months);dias=parseInt(dif.days)/30;dias=(dias>0)?1:0;tot=parseInt(anos+meses+dias);return tot;}
function formataNumero(n){n=(n+'').replace(/\./,',');return n.replace(/\d(?=(\d{3})+,)/g,'$&.');}
function drawChart(ar){var data=google.visualization.arrayToDataTable(ar);var options={width:770,height:400,chartArea:{left:40,top:20,width:"700",height:"300"},legend:{position:'top'}};var chart=new google.visualization.ColumnChart(document.getElementById('grafico'));chart.draw(data,options);}
function drawChart2(ar){var data=google.visualization.arrayToDataTable(ar);var options={chartArea:{height:"350"},is3D:true,};var chart=new google.visualization.PieChart(document.getElementById('grafico2'));chart.draw(data,options);}
function montaPrice(sd,e,jc,tc,p,vf){m=0;jt_=0;pt_=0;resultado="<table class='zebra'><tr><td colspan='2'>Tabela Price</td></tr><tr><td style='width:300px'>Entrada: </td><td>R$ "+formataNumero(e)+"</td></tr><tr><td>Valor Financiado: </td><td>R$ "+formataNumero(vf)+"</td></tr><tr><td>Juros: </td><td>"+formataNumero(jc)+" % ao mês</td></tr><tr><td>Meses: </td><td>"+formataNumero(tc)+"</td></tr><tr><td>Valor da Prestação: </td><td>R$ "+formataNumero(p)+"</td></tr></table>";resultado+="<table class='zebra'>";resultado+="<tr><th>Mês</th><th>Saldo Devedor</th><th>Amortização</th><th>Juros</th><th>Prestação</th><th>Montante Pago</th></tr>";for(i=0;i<=tc;i++){if(i==0){resultado+="<tr><td>-</td><td>"+formataNumero(sd)+"</td><td>-</td><td>-</td><td>-</td><td>"+formataNumero(e)+"</td></tr>";m=parseFloat(e);}else{j_=((parseFloat(jc)/100)*parseFloat(sd)).toFixed(2);sd=(tc!=i)?(parseFloat(sd)+parseFloat(j_)-parseFloat(p)).toFixed(2):'0,00';a=(parseFloat(p)-parseFloat(j_)).toFixed(2);m=(parseFloat(m)+parseFloat(p)).toFixed(2);resultado+="<tr><td>"+i+"</td><td>"+formataNumero(sd)+"</td><td>"+formataNumero(a)+"</td><td>"+formataNumero(j_)+"</td><td>"+formataNumero(p)+"</td><td>"+formataNumero(m)+"</td></tr>";jt_=(parseFloat(jt_)+parseFloat(j_)).toFixed(2);pt_=(parseFloat(pt_)+parseFloat(p)).toFixed(2);}}
pvs=(parseFloat(vf)-parseFloat(e)).toFixed(2);pvs=pvs+'';resultado+="<tr><td>Total:</td><td>-</td><td>"+formataNumero(pvs)+"</td><td>"+formataNumero(jt_)+"</td><td>"+formataNumero(pt_)+"</td><td>"+formataNumero(m)+"</td></tr>";resultado+="</table>";jQuery('#resultado').html(resultado);ar=new Array();ar[0]=new Array('Mês','Saldo Devedor','Prestação','Montante Pago');sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);m=parseFloat(e);jt_=0;pt_=0;for(i=0;i<tc;i++){j_=((parseFloat(jc)/100)*parseFloat(sd)).toFixed(2);sd=(tc!=i)?(parseFloat(sd)+parseFloat(j_)-parseFloat(p)).toFixed(2):'0,00';a=(parseFloat(p)-parseFloat(j_)).toFixed(2);m=(parseFloat(m)+parseFloat(p)).toFixed(2);ar[(i+1)]=new Array(i+1,parseFloat(sd),parseFloat(p),parseFloat(m));jt_=(parseFloat(jt_)+parseFloat(j_)).toFixed(2);pt_=(parseFloat(pt_)+parseFloat(p)).toFixed(2);}
drawChart(ar);}
function montaSac(e,vf,jc,tc,p,sd){m=0;jt_=0;pt_=0;sac1=0;diff=0;resultado="<table class='zebra'><tr><td colspan='2'>Tabela SAC</td></tr><tr><td style='width:300px'>Entrada: </td><td>R$ "+formataNumero(e)+"</td></tr><tr><td>Valor Financiado: </td><td>R$ "+formataNumero(vf)+"</td></tr><tr><td>Juros: </td><td>"+formataNumero(jc)+" % ao mês</td></tr><tr><td>Meses: </td><td>"+formataNumero(tc)+"</td></tr><tr><td>Valor da Prestação: </td><td>R$ "+formataNumero(p)+"</td></tr></table>";resultado+="<table class='zebra'>";resultado+="<tr><th>Mês</th><th>Saldo Devedor</th><th>Amortização</th><th>Juros</th><th>Prestação</th><th>Montante Pago</th></tr>";for(i=0;i<=tc;i++){if(i==0){resultado+="<tr><td>-</td><td>"+formataNumero(sd)+"</td><td>-</td><td>-</td><td>-</td><td>"+formataNumero(e)+"</td></tr>";m=parseFloat(e);}else{p=((parseFloat((parseFloat(vf)-parseFloat(e)))/parseInt(tc))+(parseFloat(jc)/100)*(parseFloat((parseFloat(vf)-parseFloat(e)))-((i-1)*(parseFloat((parseFloat(vf)-parseFloat(e)))/parseInt(tc))))).toFixed(2);j_=(parseFloat(sd)*(parseFloat(jc)/100)).toFixed(2);sd=(tc!=i)?(parseFloat(sd)+parseFloat(j_)-parseFloat(p)).toFixed(2):'0,00';a=(parseFloat(p)-parseFloat(j_)).toFixed(2);if(i==1)sac1=a;else{if(parseFloat(a)!=parseFloat(sac1)){diff=parseFloat(a)-parseFloat(sac1);if(parseFloat(diff)<0)diff=-1*diff;}else diff=0;}
m=(parseFloat(m)+parseFloat(p)).toFixed(2);resultado+="<tr><td>"+i+"</td><td>"+formataNumero(sd)+"</td><td>"+formataNumero(a)+"</td><td>"+formataNumero(j_)+"</td><td>"+formataNumero(p)+"</td><td>"+formataNumero(m)+"</td></tr>";jt_=(parseFloat(jt_)+parseFloat(j_)).toFixed(2);pt_=(parseFloat(pt_)+parseFloat(p)).toFixed(2);}}
pvs=(parseFloat(vf)-parseFloat(e)).toFixed(2);pvs=pvs+'';resultado+="<tr><td>Total:</td><td>-</td><td>"+formataNumero(pvs)+"</td><td>"+formataNumero(jt_)+"</td><td>"+formataNumero(pt_)+"</td><td>"+formataNumero(m)+"</td></tr>";resultado+="</table>";jQuery('#resultado').html(resultado);ar=new Array();ar[0]=new Array('Mês','Saldo Devedor','Prestação','Montante Pago');sd=(parseFloat(vf)-parseFloat(e)).toFixed(2);m=0;jt_=0;pt_=0;m=parseFloat(e);for(i=0;i<tc;i++){p=((parseFloat((parseFloat(vf)-parseFloat(e)))/parseInt(tc))+(parseFloat(jc)/100)*(parseFloat((parseFloat(vf)-parseFloat(e)))-((i)*(parseFloat((parseFloat(vf)-parseFloat(e)))/parseInt(tc))))).toFixed(2);j_=(parseFloat(sd)*(parseFloat(jc)/100)).toFixed(2);sd=(tc!=i)?(parseFloat(sd)+parseFloat(j_)-parseFloat(p)).toFixed(2):'0,00';a=(parseFloat(p)-parseFloat(j_)).toFixed(2);m=(parseFloat(m)+parseFloat(p)).toFixed(2);ar[(i+1)]=new Array(i+1,parseFloat(sd),parseFloat(p),parseFloat(m));jt_=(parseFloat(jt_)+parseFloat(j_)).toFixed(2);pt_=(parseFloat(pt_)+parseFloat(p)).toFixed(2);}
drawChart(ar);}